<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LabTrack Equipment Management</title>
  </head>
  <body>
    <h1>LabTrack Equipment Management</h1>

    <!-- Form for adding new equipment -->
    <h2>Add New Equipment</h2>
    <form id="addForm">
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" required /><br /><br />

      <label for="count">Count:</label>
      <input type="number" id="count" name="count" required /><br /><br />

      <label for="type">Type:</label>
      <input type="text" id="type" name="type" required /><br /><br />

      <label for="danger_factor">Danger Factor:</label>
      <input
        type="number"
        id="danger_factor"
        name="danger_factor"
        required
      /><br /><br />

      <label for="expiry_date">Expiry Date:</label>
      <input type="text" id="expiry_date" name="expiry_date" /><br /><br />

      <label for="lab">Lab:</label>
      <input type="text" id="lab" name="lab" required /><br /><br />

      <label for="shelf_number">Shelf Number:</label>
      <input
        type="text"
        id="shelf_number"
        name="shelf_number"
        required
      /><br /><br />

      <button type="submit">Add Equipment</button>
    </form>

    <hr />

    <!-- Displaying equipment list -->
    <h2>Equipment List</h2>
    <ul id="equipmentList"></ul>

    <hr />

    <!-- Form for bulk add -->
    <h2>Bulk Add Equipment</h2>
    <form id="bulkAddForm">
      <label for="bulkData">Bulk Data (JSON Array):</label><br />
      <textarea
        id="bulkData"
        name="bulkData"
        rows="4"
        cols="50"
        required
      ></textarea
      ><br /><br />
      <button type="submit">Bulk Add Equipment</button>
    </form>

    <hr />

    <!-- Form for bulk delete -->
    <h2>Bulk Delete Equipment</h2>
    <form id="bulkDeleteForm">
      <label for="deleteIds">Equipment IDs (comma-separated):</label><br />
      <input type="text" id="deleteIds" name="deleteIds" required /><br /><br />
      <button type="submit">Bulk Delete Equipment</button>
    </form>

    <hr />

    <!-- Form for editing equipment -->
    <h2>Edit Equipment</h2>
    <form id="editForm">
      <input type="hidden" id="editId" name="id" />
      <label for="editName">Name:</label>
      <input type="text" id="editName" name="name" required /><br /><br />

      <label for="editCount">Count:</label>
      <input type="number" id="editCount" name="count" required /><br /><br />

      <label for="editType">Type:</label>
      <input type="text" id="editType" name="type" required /><br /><br />

      <label for="editDangerFactor">Danger Factor:</label>
      <input
        type="number"
        id="editDangerFactor"
        name="danger_factor"
        required
      /><br /><br />

      <label for="editExpiryDate">Expiry Date:</label>
      <input type="text" id="editExpiryDate" name="expiry_date" /><br /><br />

      <label for="editLab">Lab:</label>
      <input type="text" id="editLab" name="lab" required /><br /><br />

      <label for="editShelfNumber">Shelf Number:</label>
      <input
        type="text"
        id="editShelfNumber"
        name="shelf_number"
        required
      /><br /><br />

      <button type="submit">Update Equipment</button>
    </form>

    <script>
      const apiBaseUrl = "http://127.0.0.1:8000";

      // Function to fetch and display equipment list
      async function fetchEquipments() {
        try {
          const response = await fetch(`${apiBaseUrl}/equipments`);
          const equipments = await response.json();

          const equipmentList = document.getElementById("equipmentList");
          equipmentList.innerHTML = "";

          equipments.forEach((equipment) => {
            const listItem = document.createElement("li");
            listItem.textContent = `ID: ${equipment.id} - ${equipment.name} - ${equipment.type} - ${equipment.lab} - ${equipment.shelf_number} (Count: ${equipment.count})`;

            // Add buttons for edit and delete
            const editButton = document.createElement("button");
            editButton.textContent = "Edit";
            editButton.onclick = () => showEditForm(equipment);
            listItem.appendChild(editButton);

            const deleteButton = document.createElement("button");
            deleteButton.textContent = "Delete";
            deleteButton.onclick = () => deleteEquipment(equipment.id);
            listItem.appendChild(deleteButton);

            equipmentList.appendChild(listItem);
          });
        } catch (error) {
          console.error("Error fetching equipments:", error);
        }
      }

      // Function to handle form submission for adding new equipment
      document
        .getElementById("addForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const formData = new FormData(this);
          const requestData = {};
          formData.forEach((value, key) => {
            requestData[key] = value;
          });

          try {
            const response = await fetch(`${apiBaseUrl}/equipment`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(requestData),
            });

            if (response.ok) {
              await fetchEquipments();
              this.reset();
            } else {
              alert("Failed to add equipment");
            }
          } catch (error) {
            console.error("Error adding equipment:", error);
          }
        });

      // Function to handle form submission for bulk adding equipment
      document
        .getElementById("bulkAddForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const bulkData = document.getElementById("bulkData").value.trim();
          if (!bulkData) {
            alert("Please enter valid JSON data.");
            return;
          }

          try {
            const response = await fetch(`${apiBaseUrl}/bulk_add`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: bulkData,
            });

            if (response.ok) {
              await fetchEquipments();
              document.getElementById("bulkData").value = ""; // Clear the input after successful bulk add
            } else {
              alert("Failed to bulk add equipment");
            }
          } catch (error) {
            console.error("Error bulk adding equipment:", error);
          }
        });

      // Function to handle form submission for bulk deleting equipment
      document
        .getElementById("bulkDeleteForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const deleteIds = document.getElementById("deleteIds").value.trim();
          if (!deleteIds) {
            alert("Please enter equipment IDs to delete.");
            return;
          }

          try {
            const response = await fetch(`${apiBaseUrl}/bulk_remove`, {
              method: "DELETE",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(deleteIds.split(",").map((id) => id.trim())),
            });

            if (response.ok) {
              await fetchEquipments();
              document.getElementById("deleteIds").value = ""; // Clear the input after successful bulk delete
            } else {
              alert("Failed to bulk delete equipment");
            }
          } catch (error) {
            console.error("Error bulk deleting equipment:", error);
          }
        });

      // Function to show edit form with pre-filled data
      function showEditForm(equipment) {
        document.getElementById("editId").value = equipment.id;
        document.getElementById("editName").value = equipment.name;
        document.getElementById("editCount").value = equipment.count;
        document.getElementById("editType").value = equipment.type;
        document.getElementById("editDangerFactor").value =
          equipment.danger_factor;
        document.getElementById("editExpiryDate").value =
          equipment.expiry_date || "";
        document.getElementById("editLab").value = equipment.lab;
        document.getElementById("editShelfNumber").value =
          equipment.shelf_number;

        // Show the edit form
        document.getElementById("editForm").style.display = "block";
      }

      // Function to handle form submission for editing equipment
      document
        .getElementById("editForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const formData = new FormData(this);
          const requestData = {};
          formData.forEach((value, key) => {
            requestData[key] = value;
          });

          try {
            const id = document.getElementById("editId").value;
            const response = await fetch(`${apiBaseUrl}/equipment/${id}`, {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(requestData),
            });

            if (response.ok) {
              await fetchEquipments();
              document.getElementById("editForm").style.display = "none"; // Hide the edit form after successful update
            } else {
              alert("Failed to update equipment");
            }
          } catch (error) {
            console.error("Error updating equipment:", error);
          }
        });

      // Function to handle deleting equipment
      async function deleteEquipment(id) {
        try {
          const response = await fetch(`${apiBaseUrl}/equipment/${id}`, {
            method: "DELETE",
          });

          if (response.ok) {
            await fetchEquipments();
          } else {
            alert(`Failed to delete equipment with ID: ${id}`);
          }
        } catch (error) {
          console.error("Error deleting equipment:", error);
        }
      }

      // Initial fetch of equipment list on page load
      fetchEquipments();
    </script>
  </body>
</html>
