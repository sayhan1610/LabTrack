<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LabTrack Equipment Management</title>
  </head>
  <body>
    <h1>LabTrack Equipment Management</h1>

    <!-- Form for adding new equipment -->
    <h2>Add New Equipment</h2>
    <form id="addForm">
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" required /><br /><br />

      <label for="count">Count:</label>
      <input type="number" id="count" name="count" required /><br /><br />

      <label for="type">Type:</label>
      <input type="text" id="type" name="type" required /><br /><br />

      <label for="danger_factor">Danger Factor:</label>
      <input
        type="number"
        id="danger_factor"
        name="danger_factor"
        required
      /><br /><br />

      <label for="expiry_date">Expiry Date:</label>
      <input type="text" id="expiry_date" name="expiry_date" /><br /><br />

      <button type="submit">Add Equipment</button>
    </form>

    <hr />

    <!-- Displaying equipment list -->
    <h2>Equipment List</h2>
    <ul id="equipmentList"></ul>

    <script>
      // Function to fetch and display equipment list
      async function fetchEquipments() {
        try {
          const response = await fetch("http://127.0.0.1:8000/equipments");
          const equipments = await response.json();

          const equipmentList = document.getElementById("equipmentList");
          equipmentList.innerHTML = "";

          equipments.forEach((equipment) => {
            const listItem = document.createElement("li");
            listItem.textContent = `${equipment.name} - ${equipment.type} (Count: ${equipment.count})`;
            equipmentList.appendChild(listItem);
          });
        } catch (error) {
          console.error("Error fetching equipments:", error);
        }
      }

      // Function to handle form submission for adding new equipment
      document
        .getElementById("addForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const formData = new FormData(this);
          const requestData = {};
          formData.forEach((value, key) => {
            requestData[key] = value;
          });

          try {
            const response = await fetch("http://127.0.0.1:8000/equipment", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(requestData),
            });

            if (response.ok) {
              await fetchEquipments();
              this.reset();
            } else {
              alert("Failed to add equipment");
            }
          } catch (error) {
            console.error("Error adding equipment:", error);
          }
        });

      // Initial fetch of equipment list on page load
      fetchEquipments();
    </script>
  </body>
</html>
